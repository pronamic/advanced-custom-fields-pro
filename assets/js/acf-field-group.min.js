!function($){acf.field_group=acf.model.extend({$fields:null,$locations:null,$options:null,actions:{ready:"init"},filters:{"get_fields 99":"get_fields"},events:{"submit #post":"submit",'click a[href="#"]':"preventDefault","click .submitdelete":"trash","mouseenter .acf-field-list":"sortable"},init:function(){this.$fields=$("#acf-field-group-fields"),this.$locations=$("#acf-field-group-locations"),this.$options=$("#acf-field-group-options"),acf.validation.active=0},sortable:function(e){if(!e.$el.hasClass("ui-sortable")){var a=this;e.$el.sortable({handle:".acf-sortable-handle",connectWith:".acf-field-list",update:function(e,i){var t=i.item;a.render_fields(),acf.do_action("sortstop",t)}})}},get_fields:function(e){return e.not('.acf-field-object[data-id="acfcloneindex"] .acf-field')},preventDefault:function(e){e.preventDefault()},render_fields:function(){var e=this;$(".acf-field-list").each(function(){var a=$(this).children(".acf-field-object").not('[data-id="acfcloneindex"]');a.each(function(a){e.update_field_meta($(this),"menu_order",a),$(this).children(".handle").find(".acf-icon").html(a+1)}),a.exists()?$(this).children(".no-fields-message").hide():$(this).children(".no-fields-message").show()})},get_field_meta:function(e,a){var i=e.find("> .meta > .input-"+a);return i.exists()?i.val():!1},update_field_meta:function(e,a,i){var t=e.find("> .meta > .input-"+a);if(!t.exists()){var d=e.find("> .meta > .input-ID").outerHTML();d=acf.str_replace("ID",a,d),t=$(d),t.val(i),e.children(".meta").append(t)}t.val()!=i&&(t.val(i),"save"!=a&&this.save_field(e,"meta"))},delete_field_meta:function(e,a){var i=e.find("> .meta > .input-"+a);i.exists()&&(i.remove(),this.save_field(e,"meta"))},save_field:function(e,a){a=a||"settings";var i=this.get_field_meta(e,"save");"settings"!=i&&i!=a&&(this.update_field_meta(e,"save",a),acf.do_action("save_field",e,a))},submit:function(e){var a=this,i=$("#titlewrap #title");i.val()||(e.preventDefault(),acf.validation.toggle(e.$el,"unlock"),alert(acf._e("title_is_required")),i.focus()),$(".acf-field-object").each(function(){var e=a.get_field_meta($(this),"save"),i=a.get_field_meta($(this),"ID"),t=$(this).hasClass("open");return"acfcloneindex"==i?void $(this).remove():(t&&a.close_field($(this)),void("settings"==e||("meta"==e?$(this).children(".settings").find('[name^="acf_fields['+i+']"]').remove():$(this).find('[name^="acf_fields['+i+']"]').remove())))})},trash:function(e){var a=confirm(acf._e("move_to_trash"));a||e.preventDefault()},render_field:function(e){var a=e.find(".field-label:first").val(),i=e.find(".field-name:first").val(),t=e.find(".field-type:first option:selected").text(),d=e.find(".field-required:first input:checked").val();e.find("> .handle .li-field-label strong a").text(a),e.find("> .handle .li-field-label .acf-required").remove(),"1"==d&&e.find("> .handle .li-field-label strong").append('<span class="acf-required">*</span>'),e.find("> .handle .li-field-name").text(i),e.find("> .handle .li-field-type").text(t)},edit_field:function(e){e.hasClass("open")?this.close_field(e):this.open_field(e)},open_field:function(e){return e.hasClass("open")?!1:(e.addClass("open"),acf.do_action("open_field",e),void e.children(".settings").animate({height:"toggle"},250))},close_field:function(e){return e.hasClass("open")?(e.removeClass("open"),acf.do_action("close_field",e),void e.children(".settings").animate({height:"toggle"},250)):!1},wipe_field:function(e){var a=e.attr("data-id"),i=e.attr("data-key"),t=acf.get_uniqid(),d="field_"+t;e.attr("data-id",t),e.attr("data-key",d),e.attr("data-orig",i),this.update_field_meta(e,"ID",""),this.update_field_meta(e,"key",d),e.find('[id*="'+a+'"]').each(function(){$(this).attr("id",$(this).attr("id").replace(a,t))}),e.find('[name*="'+a+'"]').each(function(){$(this).attr("name",$(this).attr("name").replace(a,t))}),e.find("> .handle .pre-field-key").text(d),e.find(".ui-sortable").removeClass("ui-sortable"),acf.do_action("wipe_field",e)},add_field:function(e){var a=e.children('.acf-field-object[data-id="acfcloneindex"]'),i=a.clone(),t=i.find(".field-label:first"),d=i.find(".field-name:first");this.wipe_field(i),a.before(i),t.val(""),d.val(""),setTimeout(function(){t.focus()},251),this.render_fields(),acf.do_action("append",i),this.edit_field(i),acf.do_action("add_field",i)},duplicate_field:function(e){acf.do_action("before_duplicate",e);var a=e.clone(),i=a.find(".field-label:first"),t=a.find(".field-name:first");return acf.do_action("remove",a),this.wipe_field(a),acf.do_action("after_duplicate",e,a),e.after(a),acf.do_action("append",a),setTimeout(function(){i.focus()},251),this.render_fields(),e.hasClass("open")?this.close_field(e):this.open_field(a),i.val(i.val()+" ("+acf._e("copy")+")"),t.val(t.val()+"_"+acf._e("copy")),this.save_field(a),this.render_field(a),acf.do_action("duplicate_field",a),a},move_field:function(e){var a=this,i=acf.prepare_for_ajax({action:"acf/field_group/move_field",field_id:this.get_field_meta(e,"ID")}),t=!1;return i.field_id?"settings"==this.get_field_meta(e,"save")?t=!0:e.find(".acf-field-object").not('[data-id="acfcloneindex"]').each(function(){return a.get_field_meta($(this),"ID")?void("settings"==a.get_field_meta($(this),"save")&&(t=!0)):(t=!0,!1)}):t=!0,t?void alert(acf._e("move_field_warning")):(acf.open_popup({title:acf._e("move_field"),loading:!0,height:145}),void $.ajax({url:acf.get("ajaxurl"),data:i,type:"post",dataType:"html",success:function(i){a.move_field_confirm(e,i)}}))},move_field_confirm:function(e,a){var i=this;acf.update_popup({content:a});var t={action:"acf/field_group/move_field",nonce:acf.get("nonce"),field_id:this.get_field_meta(e,"ID"),field_group_id:0};$("#acf-move-field-form").on("submit",function(){return t.field_group_id=$(this).find("select").val(),$.ajax({url:acf.get("ajaxurl"),data:t,type:"post",dataType:"html",success:function(a){acf.update_popup({content:a}),i.remove_field(e)}}),!1})},delete_field:function(e,a){a=a||!0;var i=this.get_field_meta(e,"ID");"acfcloneindex"!=i&&(i&&$("#input-delete-fields").val($("#input-delete-fields").val()+"|"+i),acf.do_action("delete_field",e),a&&this.remove_field(e))},remove_field:function(e){var a=this,i=e.closest(".acf-field-list");e.css({height:e.height(),width:e.width(),position:"absolute"}),e.wrap('<div class="temp-field-wrap" style="height:'+e.height()+'px"></div>'),e.animate({opacity:0},250);var t=0,d=!1;1==i.children(".acf-field-object").length&&(d=i.children(".no-fields-message"),t=d.outerHeight()),e.parent(".temp-field-wrap").animate({height:t},250,function(){d&&d.show(),acf.do_action("remove",$(this)),$(this).remove(),a.render_fields()})},change_field_type:function(e){var a=e.closest("tbody"),i=a.closest(".acf-field-object"),t=i.parent().closest(".acf-field-object"),d=i.attr("data-key"),n=i.attr("data-type"),l=e.val();i.removeClass("acf-field-object-"+n.replace("_","-")),i.addClass("acf-field-object-"+l.replace("_","-")),i.attr("data-type",l),i.data("xhr")&&i.data("xhr").abort();var f=a.children('.acf-field[data-setting="'+n+'"]'),c="";if(f.each(function(){c+=$(this).outerHTML()}),f.remove(),acf.update(d+"_settings_"+n,c),this.render_field(i),c=acf.get(d+"_settings_"+l))return a.children('.acf-field[data-name="conditional_logic"]').before(c),acf.update(d+"_settings_"+l,""),void acf.do_action("change_field_type",i);var r=$('<tr class="acf-field"><td class="acf-label"></td><td class="acf-input"><div class="acf-loading"></div></td></tr>');a.children('.acf-field[data-name="conditional_logic"]').before(r);var o={action:"acf/field_group/render_field_settings",nonce:acf.o.nonce,parent:acf.o.post_id,field_group:acf.o.post_id,prefix:e.attr("name").replace("[type]",""),type:l};t.exists()&&(o.parent=this.get_field_meta(t,"ID"));var s=$.ajax({url:acf.o.ajaxurl,data:o,type:"post",dataType:"html",success:function(e){if(e){var a=$(e);r.after(a),acf.do_action("append",a),acf.do_action("change_field_type",i)}},complete:function(){r.remove()}});i.data("xhr",s)},change_field_label:function(e){var a=e.find(".field-label:first"),i=e.find(".field-name:first"),t=e.attr("data-type");if(""==i.val()){var d=a.val();d=acf.str_sanitize(d),i.val(d).trigger("change")}this.render_field(e),acf.do_action("change_field_label",e)},change_field_name:function(e){var a=e.find(".field-name:first");"field_"===a.val().substr(0,6)&&(alert(acf._e("field_name_start")),setTimeout(function(){a.focus()},1))}}),acf.field_group.field=acf.model.extend({events:{"click .edit-field":"edit","click .duplicate-field":"duplicate","click .move-field":"move","click .delete-field":"delete","click .add-field":"add","change .field-type":"change_type","blur .field-label":"change_label","blur .field-name":"change_name","keyup .field-label":"render","keyup .field-name":"render","change .field-required input":"render","change .acf-field-object input":"save","change .acf-field-object textarea":"save","change .acf-field-object select":"save"},event:function(e){return e.$field=e.$el.closest(".acf-field-object"),e},edit:function(e){acf.field_group.edit_field(e.$field)},duplicate:function(e){acf.field_group.duplicate_field(e.$field)},move:function(e){acf.field_group.move_field(e.$field)},"delete":function(e){acf.field_group.delete_field(e.$field)},add:function(e){var a=e.$el.closest(".acf-field-list-wrap").children(".acf-field-list");acf.field_group.add_field(a)},change_type:function(e){acf.field_group.change_field_type(e.$el)},change_label:function(e){acf.field_group.change_field_label(e.$field)},change_name:function(e){acf.field_group.change_field_name(e.$field)},render:function(e){acf.field_group.render_field(e.$field)},save:function(e){acf.field_group.save_field(e.$field)}}),acf.field_group.conditional_logic=acf.model.extend({actions:{open_field:"render_field",change_field_label:"render_fields",change_field_type:"render_fields"},events:{"click .add-conditional-rule":"add_rule","click .add-conditional-group":"add_group","click .remove-conditional-rule":"remove_rule","change .conditional-toggle input":"change_toggle","change .conditional-rule-param":"change_param"},render_fields:function(){var e=this;$(".acf-field-object.open").each(function(){e.render_field($(this))})},render_field:function(e){var a=this,i=e.attr("data-key"),t=e.parents(".acf-field-list"),d=e.find('.acf-field[data-name="conditional_logic"]:last'),n=[];$.each(t,function(e){var a=0==e?acf._e("sibling_fields"):acf._e("parent_fields");$(this).children(".acf-field-object").each(function(){var e=$(this),t=e.attr("data-key"),d=e.attr("data-type"),l=e.find(".field-label:first").val();-1!==$.inArray(d,["select","checkbox","true_false","radio"])&&"acfcloneindex"!=t&&t!=i&&n.push({value:t,label:l,group:a})})}),n.length||n.push({value:"",label:acf._e("no_fields")}),d.find(".rule").each(function(){a.render_rule($(this),n)})},render_rule:function(e,a){var i=e.find(".conditional-rule-param"),t=e.find(".conditional-rule-value");a&&acf.render_select(i,a);var d=$('.acf-field-object[data-key="'+i.val()+'"]'),n=d.attr("data-type"),l=[];if("true_false"==n)l.push({value:1,label:acf._e("checked")});else if("select"==n||"checkbox"==n||"radio"==n){var f=d.find('.acf-field[data-name="choices"] textarea').val().split("\n");$.each(f,function(e,a){a=a.split(":"),a[1]=a[1]||a[0],l.push({value:$.trim(a[0]),label:$.trim(a[1])})});var c=d.find('.acf-field[data-name="allow_null"]');c.exists()&&"1"==c.find("input:checked").val()&&l.unshift({value:"",label:acf._e("null")})}acf.render_select(t,l)},change_toggle:function(e){var a=e.$el,i=a.val(),t=a.closest(".acf-input");"1"==i?(t.find(".rule-groups").show(),t.find(".rule-groups").find("[name]").removeAttr("disabled")):(t.find(".rule-groups").hide(),t.find(".rule-groups").find("[name]").attr("disabled","disabled"))},change_param:function(e){var a=e.$el.closest(".rule");this.render_rule(a)},add_rule:function(e){var a=e.$el.closest("tr");$tr2=acf.duplicate(a),$tr2.find("select:first").trigger("change")},remove_rule:function(e){var a=e.$el.closest("tr");a.find("select:first").trigger("change"),0==a.siblings("tr").length&&a.closest(".rule-group").remove(),a.remove()},add_group:function(e){var a=e.$el.closest(".rule-groups"),i=a.find(".rule-group:last");$group2=acf.duplicate(i),$group2.find("h4").text(acf._e("or")),$group2.find("tr:not(:first)").remove(),$group2.find("select:first").trigger("change")}}),acf.field_group.locations=acf.model.extend({events:{"click .add-location-rule":"add_rule","click .add-location-group":"add_group","click .remove-location-rule":"remove_rule","change .location-rule-param":"change_rule"},add_rule:function(e){var a=e.$el.closest("tr");$tr2=acf.duplicate(a)},remove_rule:function(e){var a=e.$el.closest("tr");a.find("select:first").trigger("change"),0==a.siblings("tr").length&&a.closest(".rule-group").remove(),a.remove()},add_group:function(e){var a=e.$el.closest(".rule-groups"),i=a.find(".rule-group:last");$group2=acf.duplicate(i),$group2.find("h4").text(acf._e("or")),$group2.find("tr:not(:first)").remove()},change_rule:function(e){var a=e.$el,i=a.closest("tr"),t=i.attr("data-id"),d=i.closest(".rule-group"),n=d.attr("data-id"),l=$('<div class="acf-loading"></div>');i.find("td.value").html(l),$.ajax({url:acf.get("ajaxurl"),data:acf.prepare_for_ajax({action:"acf/field_group/render_location_value",rule_id:t,group_id:n,param:a.val(),value:""}),type:"post",dataType:"html",success:function(e){l.replaceWith(e)}})}}),acf.add_action("open_field change_field_type",function(e){e.find(".acf-field[data-append]").each(function(){var e=$(this).data("append");if($sibling=$(this).siblings('[data-name="'+e+'"]'),$sibling.exists()){var a=$sibling.children(".acf-input"),i=a.children(".acf-hl");i.exists()||(a.wrapInner('<ul class="acf-hl"><li></li></ul>'),i=a.children(".acf-hl"));var t=$("<li></li>").append($(this).children(".acf-input").children());i.append(t),i.attr("data-cols",i.children().length),$(this).remove()}})});var e=acf.model.extend({actions:{open_field:"render",change_field_type:"render"},events:{'change .acf-field[data-name="ui"] input':"render"},event:function(e){return e.$el.closest(".acf-field-object")},render:function(e){if("select"==e.attr("data-type")){var a=e.find('.acf-field[data-name="ui"] input:checked').val();"1"==a?e.find('.acf-field[data-name="ajax"]').show():e.find('.acf-field[data-name="ajax"]').hide()}}}),a=acf.model.extend({actions:{open_field:"render",change_field_type:"render"},events:{'change .acf-field[data-name="other_choice"] input':"render"},event:function(e){return e.$el.closest(".acf-field-object")},render:function(e){if("radio"==e.attr("data-type")){var a=e.find('.acf-field[data-name="other_choice"] input:checked').val();"1"==a?e.find('.acf-field[data-name="save_other_choice"]').show():(e.find('.acf-field[data-name="save_other_choice"]').hide(),e.find('.acf-field[data-name="save_other_choice"] input').prop("checked",!1))}}}),i=acf.model.extend({actions:{open_field:"render",change_field_type:"render"},events:{'change .acf-field[data-name="display_format"] input':"render",'change .acf-field[data-name="return_format"] input':"render"},event:function(e){return e.$el.closest(".acf-field-object")},render:function(e){"date_picker"==e.attr("data-type")&&$.each(["display_format","return_format"],function(a,i){var t=e.find('.acf-field[data-name="'+i+'"] input[type="radio"]:checked'),d=e.find('.acf-field[data-name="'+i+'"] input[type="text"]');"other"!=t.val()&&d.val(t.val())})}}),t=acf.model.extend({actions:{open_field:"render",change_field_type:"render"},render:function(e){"tab"==e.attr("data-type")&&e.find('.acf-field[data-name="name"] input').val("").trigger("change")}}),d=acf.model.extend({actions:{open_field:"render",change_field_type:"render"},render:function(e){"message"==e.attr("data-type")&&e.find('.acf-field[data-name="name"] input').val("").trigger("change")}});acf.field_group.screen=acf.model.extend({actions:{ready:"ready"},events:{"click #acf-field-key-hide":"toggle"},ready:function(){var e=$("#adv-settings"),a=e.find("#acf-append-show-on-screen");e.find(".metabox-prefs").append(a.html()),e.find(".metabox-prefs br").remove(),a.remove(),this.render()},toggle:function(e){var a=e.$el.prop("checked")?1:0;acf.update_user_setting("show_field_keys",a),this.render()},render:function(){var e=acf.serialize_form($("#adv-settings"));e.show_field_keys=parseInt(e.show_field_keys);var a=acf.field_group.$fields;e.show_field_keys?a.addClass("show-field-keys"):a.removeClass("show-field-keys")}})}(jQuery);
